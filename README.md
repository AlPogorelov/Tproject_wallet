# Wallet REST API
Django REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–µ–π.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤ —Å UUID –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏

‚úÖ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (DEPOSIT –æ–ø–µ—Ä–∞—Ü–∏–∏)

‚úÖ –°–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (WITHDRAW –æ–ø–µ—Ä–∞—Ü–∏–∏)

‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞

‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç race condition –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

‚úÖ –ü–æ–ª–Ω–∞—è Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend: 
<li> Django 4.2 + Django REST Framework </li>

### Database: 
<li> PostgreSQL 15 </li>

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è: 
<li> Docker + Docker Compose </li>

### –Ø–∑—ã–∫: 
<li> Python 3.12 </li>

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: Django Test Framework + –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
Docker 20.10+

Docker Compose 2.0+

‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
–ó–∞–ø—É—Å–∫ —Å Docker Compose
bash
##  –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
`git clone <repository-url>
cd Tproject_wallet`

## –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
`cp .env.example .env`

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
`docker-compose up --build`

–ü—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http://localhost:8000
## –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–µ–∑ Docker)

bash

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

`pip install -r requirements.txt`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
`python manage.py migrate`

## –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
`python manage.py runserver`
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
text
Tproject_wallet/
‚îú‚îÄ‚îÄ config/                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Django –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ wallet/                 # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ models.py          # –ú–æ–¥–µ–ª—å Wallet
‚îÇ   ‚îú‚îÄ‚îÄ views.py           # API –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py     # DRF —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ tests.py           # –¢–µ—Å—Ç—ã (–≤–∫–ª—é—á–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ)
‚îÇ   ‚îî‚îÄ‚îÄ urls.py            # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile             # –û–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt       # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ manage.py             # Django management script

## üîå API Endpoints
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
`http
GET /api/v1/wallets/{wallet_uuid}`
```Response:
json
{
  "id": "uuid-–∫–æ—à–µ–ª—å–∫–∞",
  "amount": "1000.00",
  "at_create": "2024-01-15T10:30:00Z",
  "time_update": "2024-01-15T10:35:00Z"
}
```

–í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å –∫–æ—à–µ–ª—å–∫–æ–º
`http
POST /api/v1/wallets/{wallet_uuid}/operation`

Request Body:
```
json
{
  "operation_type": "DEPOSIT",  // –∏–ª–∏ "WITHDRAW"
  "amount": "1000.00"
}
```
Response:
```
json
{
  "message": "–ö–æ—à–µ–ª–µ–∫ –ø–æ–ø–æ–ª–Ω–µ–Ω",
  "wallet": {
    "id": "uuid-–∫–æ—à–µ–ª—å–∫–∞",
    "amount": "2000.00",
    "at_create": "2024-01-15T10:30:00Z",
    "time_update": "2024-01-15T10:35:00Z"
  }
}
```
## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

bash 

`python manage.py test --keepdb wallet
`

–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:

<ol> –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–Ω—è—Ç–∏—è —Å—Ä–µ–¥—Å—Ç–≤

–ó–∞—â–∏—Ç–∞ –æ—Ç race condition

–°–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è + —Å–Ω—è—Ç–∏—è)

–ü–æ–≤–µ–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ë–î </ol>

## üîí –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –±–ª–∞–≥–æ–¥–∞—Ä—è:

<ol> –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ python </ol>

 –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—à–µ–ª—å–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

`wallet = Wallet.objects.select_for_update().get(id=wallet_uuid)`

–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ python

–ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

` Wallet.objects.filter(id=wallet_uuid).update(amount=models.F('amount') + amount) `

## üê≥ Docker –∫–æ–º–∞–Ω–¥—ã
bash
–ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

`docker-compose up -d`

## –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
````
docker-compose logs -f web
docker-compose logs -f db
````

## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py shell
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
`docker-compose down`

## –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è volumes)
`docker-compose down -v`

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ —á–µ—Ä–µ–∑ Django Admin
bash

`docker-compose exec web python manage.py createsuperuser`

–ó–∞—Ç–µ–º –∑–∞–π–¥–∏—Ç–µ –≤ http://localhost:8000/admin


## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —á–µ—Ä–µ–∑ curl

–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å

bash 

`curl http://localhost:8000/api/v1/wallets/{wallet_uuid}`

# –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫
```
curl -X POST http://localhost:8000/api/v1/wallets/{wallet_uuid}/operation \
  -H "Content-Type: application/json" \
  -d '{"operation_type": "DEPOSIT", "amount": "1000.00"}'
  ```

# –°–Ω—è—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
```
curl -X POST http://localhost:8000/api/v1/wallets/{wallet_uuid}/operation \
  -H "Content-Type: application/json" \
  -d '{"operation_type": "WITHDRAW", "amount": "500.00"}'
 ```
## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ HTTP —Å—Ç–∞—Ç—É—Å—ã:

200 OK - –æ–ø–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

400 Bad Request - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

404 Not Found - –∫–æ—à–µ–ª–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω

500 Internal Server Error - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ 


## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example:
```
env
SECRET_KEY =
DEBUG =

# Postgresql
POSTGRES_DB=
POSTGRES_USER=
POSTGRES_PASSWORD=
POSTGRES_HOST=
POSTGRES_PORT=
```
## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è